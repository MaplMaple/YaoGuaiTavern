# å­˜æ¡£ç‚¹ç³»ç»Ÿä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

å­˜æ¡£ç‚¹ç³»ç»Ÿå…è®¸ç©å®¶åœ¨æ¸¸æˆä¸­è®¾ç½®é‡ç”Ÿç‚¹ã€‚å½“ç©å®¶é è¿‘å­˜æ¡£ç‚¹æ—¶ä¼šè‡ªåŠ¨è§£é”ï¼Œä¹‹åå¯ä»¥å›åˆ°æœ€è¿‘çš„å·²è§£é”å­˜æ¡£ç‚¹ã€‚

## ğŸ¯ ä¸»è¦ç»„ä»¶

### 1. Checkpoint (æ£€æŸ¥ç‚¹)
å•ä¸ªå­˜æ¡£ç‚¹å¯¹è±¡ï¼Œé™„åŠ åˆ°åœºæ™¯ä¸­çš„ GameObject ä¸Šã€‚

### 2. CheckpointManager (æ£€æŸ¥ç‚¹ç®¡ç†å™¨)
ç®¡ç†æ‰€æœ‰æ£€æŸ¥ç‚¹çš„å•ä¾‹ç®¡ç†å™¨ã€‚

### 3. PlayerController (æ‰©å±•åŠŸèƒ½)
ç©å®¶æ§åˆ¶å™¨ä¸­æ–°å¢çš„å­˜æ¡£ç‚¹ç›¸å…³åŠŸèƒ½ã€‚

## ğŸš€ è®¾ç½®æ­¥éª¤

### æ­¥éª¤ 1: åˆ›å»º CheckpointManager

1. åœ¨åœºæ™¯ä¸­åˆ›å»ºä¸€ä¸ªç©ºçš„ GameObject
2. å‘½åä¸º "CheckpointManager"
3. æ·»åŠ  `CheckpointManager` ç»„ä»¶

### æ­¥éª¤ 2: åˆ›å»ºå­˜æ¡£ç‚¹

1. åœ¨åœºæ™¯ä¸­åˆ›å»º GameObjectï¼ˆä¾‹å¦‚ï¼šSprite æˆ– ç©ºå¯¹è±¡ï¼‰
2. æ·»åŠ  `Checkpoint` ç»„ä»¶
3. æ·»åŠ  `Collider2D` ç»„ä»¶ï¼ˆç”¨äºæ£€æµ‹ç©å®¶è·ç¦»ï¼‰
   - å¯ä»¥ä½¿ç”¨ CircleCollider2D æˆ– BoxCollider2D
   - è®¾ç½®ä¸º Trigger æˆ– éTrigger éƒ½å¯ä»¥
4. é…ç½® Checkpoint å‚æ•°ï¼š
   - **Checkpoint Id**: æ£€æŸ¥ç‚¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä½¿ç”¨ GameObject åç§°ï¼‰
   - **Is Unlocked By Default**: æ˜¯å¦é»˜è®¤è§£é”ï¼ˆç¬¬ä¸€ä¸ªå­˜æ¡£ç‚¹å»ºè®®è®¾ä¸º trueï¼‰
   - **Unlock Radius**: è‡ªå®šä¹‰è§£é”èŒƒå›´åŠå¾„ï¼ˆ0 åˆ™ä½¿ç”¨ PlayerController çš„è®¾ç½®ï¼‰
   - **Unlock Effect**: è§£é”æ—¶çš„ç‰¹æ•ˆé¢„åˆ¶ä½“ï¼ˆå¯é€‰ï¼‰
   - **Locked Color**: æœªè§£é”æ—¶çš„é¢œè‰²
   - **Unlocked Color**: å·²è§£é”æ—¶çš„é¢œè‰²
5. åœ¨ Scene è§†å›¾ä¸­å¯ä»¥çœ‹åˆ°è§£é”èŒƒå›´çš„ Gizmos å¯è§†åŒ–

### æ­¥éª¤ 3: é…ç½®ç©å®¶

åœ¨ PlayerController çš„ Inspector ä¸­ï¼š
- **Unlock Checkpoint Distance**: è®¾ç½®è§£é”å­˜æ¡£ç‚¹çš„è·ç¦»ï¼ˆé»˜è®¤ 2 ç±³ï¼‰

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### è‡ªåŠ¨è§£é”å­˜æ¡£ç‚¹

å½“ç©å®¶ä¸å­˜æ¡£ç‚¹çš„è·ç¦»å°äº `unlockCheckpointDistance` æ—¶ï¼Œå­˜æ¡£ç‚¹ä¼šè‡ªåŠ¨è§£é”ã€‚

### æ‰‹åŠ¨å›åˆ°å­˜æ¡£ç‚¹

é€šè¿‡ä»£ç è°ƒç”¨ï¼š

```csharp
// å›åˆ°æœ€è¿‘çš„å·²è§£é”å­˜æ¡£ç‚¹
PlayerController.instance.RespawnAtNearestCheckpoint();

// å›åˆ°æŒ‡å®šçš„å­˜æ¡£ç‚¹
Checkpoint specificCheckpoint = CheckpointManager.Instance.GetCheckpointById("checkpoint_01");
PlayerController.instance.RespawnAtCheckpoint(specificCheckpoint);
```

### åœ¨ InputManager ä¸­æ·»åŠ å¿«æ·é”®ï¼ˆç¤ºä¾‹ï¼‰

```csharp
// åœ¨ InputManager.cs çš„ Update æ–¹æ³•ä¸­æ·»åŠ ï¼š
if (Input.GetKeyDown(KeyCode.R))
{
    PlayerController.instance.RespawnAtNearestCheckpoint();
}
```

## ğŸ® åŠŸèƒ½ç‰¹æ€§

### PlayerController æ–°å¢åŠŸèƒ½

1. **UpdateCheckpointDetection()** - è‡ªåŠ¨æ£€æµ‹å¹¶è§£é”é™„è¿‘çš„å­˜æ¡£ç‚¹
2. **RespawnAtNearestCheckpoint()** - å›åˆ°æœ€è¿‘çš„å·²è§£é”å­˜æ¡£ç‚¹
3. **RespawnAtCheckpoint(Checkpoint checkpoint)** - å›åˆ°æŒ‡å®šå­˜æ¡£ç‚¹
4. **ResetPlayerState()** - é‡ç½®ç©å®¶æ‰€æœ‰çŠ¶æ€ï¼ˆé€Ÿåº¦ã€æ”»å‡»ã€å†²åˆºç­‰ï¼‰

### é‡ç½®çš„ç©å®¶çŠ¶æ€åŒ…æ‹¬ï¼š

- âœ… é€Ÿåº¦å½’é›¶
- âœ… é‡ç½®è·³è·ƒçŠ¶æ€
- âœ… é‡ç½®çˆ¬å¢™çŠ¶æ€
- âœ… é‡ç½®æ”»å‡»çŠ¶æ€
- âœ… é‡ç½®å†²åˆºçŠ¶æ€
- âœ… æ¸…é™¤å—å‡»çŠ¶æ€
- âœ… æ¢å¤å¯è§æ€§å’Œé¢œè‰²
- âœ… æ¢å¤æ—¶é—´æµé€Ÿ

## ğŸ”§ é«˜çº§ç”¨æ³•

### è·å–æ‰€æœ‰å·²è§£é”çš„æ£€æŸ¥ç‚¹

```csharp
List<Checkpoint> unlockedCheckpoints = CheckpointManager.Instance.GetAllUnlockedCheckpoints();
```

### é€šè¿‡ ID æŸ¥æ‰¾æ£€æŸ¥ç‚¹

```csharp
Checkpoint checkpoint = CheckpointManager.Instance.GetCheckpointById("checkpoint_01");
```

### æ‰‹åŠ¨è§£é”æ£€æŸ¥ç‚¹

```csharp
Checkpoint checkpoint = GetComponent<Checkpoint>();
checkpoint.Unlock();
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **CheckpointManager å¿…é¡»åœ¨åœºæ™¯ä¸­å­˜åœ¨**ï¼Œå¦åˆ™åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œ
2. **è‡³å°‘ä¸€ä¸ªæ£€æŸ¥ç‚¹åº”è¯¥è®¾ç½®ä¸ºé»˜è®¤è§£é”**ï¼Œé˜²æ­¢ç©å®¶æ²¡æœ‰é‡ç”Ÿç‚¹
3. **ç¡®ä¿å­˜æ¡£ç‚¹æœ‰ Collider2D ç»„ä»¶**ï¼Œç”¨äºè·ç¦»æ£€æµ‹
4. æ£€æŸ¥ç‚¹çš„ **Layer å’Œ Physics2D è®¾ç½®**åº”è¯¥å…è®¸ä¸ç©å®¶æ£€æµ‹

## ğŸ¨ è‡ªå®šä¹‰

### è‡ªå®šä¹‰è§£é”æ•ˆæœ

åœ¨ Checkpoint ç»„ä»¶ä¸­è®¾ç½® `unlockEffect` å­—æ®µï¼ŒæŒ‡å®šè§£é”æ—¶æ’­æ”¾çš„ç‰¹æ•ˆé¢„åˆ¶ä½“ã€‚

### è‡ªå®šä¹‰è§†è§‰åé¦ˆ

- ä¿®æ”¹ `lockedColor` å’Œ `unlockedColor` æ”¹å˜å­˜æ¡£ç‚¹çš„é¢œè‰²
- åœ¨ Checkpoint.cs çš„ `UpdateVisual()` æ–¹æ³•ä¸­è‡ªå®šä¹‰æ›´å¤šè§†è§‰æ•ˆæœ

## ğŸ‘ï¸ Gizmos å¯è§†åŒ–

æ¯ä¸ªå­˜æ¡£ç‚¹ä¼šåœ¨ Scene è§†å›¾ä¸­ç»˜åˆ¶å…¶è§£é”èŒƒå›´ï¼š

### è§†è§‰å…ƒç´ 

1. **åŠé€æ˜åœ†çƒ** - è¡¨ç¤ºè§£é”èŒƒå›´çš„åŒºåŸŸ
2. **çº¿æ¡†åœ†åœˆ** - æ¸…æ™°æ ‡è®°èŒƒå›´è¾¹ç•Œ
3. **ä¸­å¿ƒç‚¹æ ‡è®°** - ç™½è‰²å°çƒæ ‡è®°å­˜æ¡£ç‚¹ä½ç½®

### é¢œè‰²è¯´æ˜

- **ç°è‰²** (é»˜è®¤) - æœªè§£é”çš„å­˜æ¡£ç‚¹
- **ç»¿è‰²** (é»˜è®¤) - å·²è§£é”çš„å­˜æ¡£ç‚¹
- é¢œè‰²å¯é€šè¿‡ `lockedColor` å’Œ `unlockedColor` å‚æ•°è‡ªå®šä¹‰

### é€‰ä¸­æ•ˆæœ

- **æœªé€‰ä¸­æ—¶** - åŠé€æ˜æ˜¾ç¤ºï¼ˆalpha = 0.3ï¼‰
- **é€‰ä¸­æ—¶** - å®Œå…¨ä¸é€æ˜æ˜¾ç¤ºï¼ˆalpha = 1.0ï¼‰ï¼Œæ›´æ¸…æ™°

### è‡ªå®šä¹‰è§£é”èŒƒå›´

æ¯ä¸ªå­˜æ¡£ç‚¹å¯ä»¥è®¾ç½®ç‹¬ç«‹çš„è§£é”èŒƒå›´ï¼š
- è®¾ç½® `Unlock Radius = 0` - ä½¿ç”¨ PlayerController çš„å…¨å±€è®¾ç½®
- è®¾ç½® `Unlock Radius > 0` - ä½¿ç”¨è¯¥å­˜æ¡£ç‚¹çš„è‡ªå®šä¹‰èŒƒå›´

è¿™æ ·å¯ä»¥ä¸ºä¸åŒçš„å­˜æ¡£ç‚¹è®¾ç½®ä¸åŒçš„è§£é”è·ç¦»ï¼

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šå­˜æ¡£ç‚¹ä¸ä¼šè‡ªåŠ¨è§£é”
- æ£€æŸ¥ CheckpointManager æ˜¯å¦åœ¨åœºæ™¯ä¸­
- æ£€æŸ¥å­˜æ¡£ç‚¹æ˜¯å¦æœ‰ Collider2D
- æ£€æŸ¥ `unlockCheckpointDistance` çš„å€¼æ˜¯å¦åˆé€‚
- ç¡®ä¿å­˜æ¡£ç‚¹å’Œç©å®¶çš„ Layer å¯ä»¥ç›¸äº’æ£€æµ‹

### é—®é¢˜ï¼šå›åˆ°å­˜æ¡£ç‚¹åç©å®¶çŠ¶æ€å¼‚å¸¸
- `ResetPlayerState()` æ–¹æ³•ä¼šé‡ç½®æ‰€æœ‰çŠ¶æ€
- å¦‚æœéœ€è¦ä¿ç•™æŸäº›çŠ¶æ€ï¼Œä¿®æ”¹ `ResetPlayerState()` æ–¹æ³•

### é—®é¢˜ï¼šæ‰¾ä¸åˆ°æœ€è¿‘çš„å­˜æ¡£ç‚¹
- ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªå­˜æ¡£ç‚¹å·²è§£é”
- æ£€æŸ¥ CheckpointManager æ˜¯å¦æ­£ç¡®æ³¨å†Œäº†æ‰€æœ‰æ£€æŸ¥ç‚¹


